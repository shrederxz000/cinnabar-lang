# C++ Code Style Guide

Документ описывает единый стиль форматирования и написания кода на C++. Правила предназначены для обеспечения читаемости, предсказуемости и удобства сопровождения кода.

---

## 1. Нейминг и переменные

### 1.1 Общие принципы

* Имена должны быть **говорящими**, без избыточных сокращений.
* Один стиль — одна сущность: имя должно отражать назначение, а не реализацию.
* Язык имён — **английский**.

### 1.2 Стиль имён

* `snake_case` — для:

  * локальных переменных
  * параметров функций
* `camelCase` — **запрещён**.
* `PascalCase` — для:

  * типов (`class`, `struct`, `enum`, `using`)
* `UPPER_SNAKE_CASE` — для:

  * `enum` полей
  * макросов

### 1.3 Переменные

* Инициализация **обязательна**.
* Объявление максимально близко к месту использования.
* Одна переменная — одна строка.

```cpp
int count = 0;
float delta_time = 0.0f;
```

### 1.4 Константы

* Использовать `constexpr` / `const`, не `#define`.

```cpp
constexpr int MAX_RETRIES = 3;
```

---

## 2. Условия, циклы и управляющие конструкции

### 2.1 if / else

* Всегда использовать фигурные скобки, даже для однострочных тел.

```cpp
if (is_valid) {
    process();
} else {
    handle_error();
}
```

### 2.2 switch

* `default` обязателен.
* Каждый `case` — отдельный блок.

```cpp
switch (state) {
case STATE_IDLE: {
    reset();
    break;
}
case STATE_RUN: {
    run();
    break;
}
default: {
    unreachable();
}
}
```

### 2.3 Циклы

* Предпочтение `for` перед `while`, если известны границы.
* `while (true)` допустим только с явным `break`.

```cpp
for (int i = 0; i < count; ++i) {
    step(i);
}
```

---

## 3. Классы и структуры (общие правила)

> Подробные правила классов описываются в отдельном разделе.

### 3.1 Размещение

* Один тип — один файл (исключения: маленькие POD-структуры).
* `struct` — для пассивных структур данных.
* `class` — для логики и инвариантов.

### 3.2 Порядок членов

2. protected
3. private
1. public

---

## 4. include и директивы препроцессора

### 4.1 Порядок include

1. Заголовок текущего файла
2. Стандартная библиотека
3. Сторонние библиотеки
4. Проектные заголовки

```cpp
#include "my_class.h"

#include <vector>
#include <string>

#include <fmt/core.h>

#include "engine/context.h"
```

### 4.2 Совместимость с C

* Заголовки, которые должны быть совместимы с C, оформляются как `.h`.
* Внутри таких заголовков используется `extern "C"` при компиляции C++.

```cpp
#ifdef __cplusplus
extern "C" {
#endif

void c_api_function(int value);

#ifdef __cplusplus
}
#endif
```

* `.hpp` / `.hxx` — только C++ API, не подключаются из C.
* C++-код может подключать C-заголовки без ограничений.

### 4.3 Правила

* `#pragma once` обязателен.
* Макросы — только при необходимости.
* Имена макросов — `UPPER_SNAKE_CASE`.

---

## 5. enum

### 5.1 Общие правила

* Использовать `enum class`.
* Все поля — **В ВЕРХНЕМ РЕГИСТРЕ**.

```cpp
enum class TokenKind {
    IDENTIFIER,
    NUMBER,
    STRING,
    END_OF_FILE
};
```

### 5.2 Значения

* Явные значения задавать только при необходимости.

---

## 6. Scope и области видимости

### 6.1 Минимальный scope

* Переменные должны жить **минимально возможное время**.

```cpp
if (auto it = map.find(key); it != map.end()) {
    use(it->second);
}
```

### 6.2 Пространства имён

* Использовать `namespace` для логической группировки.
* `using namespace` запрещён в заголовках.

```cpp
namespace lexer {
    // отделяем оступом
    Token scan();
    // отделяем отступом
} // namespace lexer
```

### 6.3 Анонимные namespace

* Допустимы только в `.cpp` файлах.

---

## 7. Форматирование и читаемость

### 7.1 Завершающие комментарии

Допускается и рекомендуется оставлять комментарии с указанием окончания блока:

```cpp
struct Parser {
    long value;
}; // struct Parser

if (condition) {
    work();
} else {
    fallback();
} // if (cond)
```

Разрешено для:

* `struct`, `class`, `enum`
* `namespace`
* `if / else`
* `switch / case`
* `while / for`
* функций

### 7.2 Вертикальные отступы

* Между функциями — **одна пустая строка**.
* Следующие конструкции визуально выделяются пустыми строками сверху и снизу:

  * конструкторы
  * объявления классов и структур
  * методы и функции с длинным типом (2 строки и более)
  * блоки `if / else`
  * циклы `while / for`
  * `switch / case`

Пример:

```cpp

Parser::Parser(Config config)
    : config_(config) {}

void Parser::run() {
    // отступ сверху
    if (ready) {
        execute();
    }
    // отступ снизу
}
```

---

## 8. Заключение

Данный документ является живым и может дополняться и уточняться по мере развития кодовой базы, а так-же служит, чтобы главный конребьютер разбирался в совем спагетти-коде :).
